pipeline {
        
    agent {label "slave-ssh"}
        
    stages {
       stage("Clone") {
           steps {
            sh 'git clone -b $ghprbSourceBranch git@github.com:L0rhammer/jenkinspipelines'
           }
       }

       stage("Build") {
           steps {
           sh "bash ./build.sh "
           }
       }
       
       stage("Test") {
           steps {
            sh "bash ./test.sh >test_result.txt"
           }
       }
    }    
    post {
       always {
           writeFile file: "artifact.txt", text: "${currentBuild.result}"
           archiveArtifacts artifacts: "artifact.txt"
       }
       failure {
           archiveArtifacts artifacts: "test_result.txt"
       }
    }
}
